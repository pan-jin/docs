# http 标准库发送网络请求

### 1.发送Get请求

```go
func testGet() {
	url := "http://apis.juhe.cn/simpleWeather/query?city=上海&key=e1ec69449d50d18e0b2a2ec3bf0"
	r, err := http.Get(url)
	if err != nil {
		log.Fatal(err) //输出错误信息
	}
	defer r.Body.Close()
	b, _ := ioutil.ReadAll(r.Body) 
	fmt.Printf("b:%v\n", string(b))
}

```



### 2. Get 请求的参数作为变量

```go
func testGet2() {
	params := url.Values{}
	Url, err := url.Parse("http://apis.juhe.cn/simpleWeather/query")
	if err != nil {
		return
	}
	params.Set("city", "六安")
	params.Set("key", "e1ec69449d50d18e0b2ab36bf0")
	//	如果参数中有中文 那么这个方法要进行URLEncode
	Url.RawQuery = params.Encode()
	urlpath := Url.String()
	fmt.Println(urlpath)

	resp, err := http.Get(urlpath)
	if err != nil {
		log.Fatal(err)
	}

	defer resp.Body.Close()
	body, _ := ioutil.ReadAll(resp.Body)
	fmt.Printf("body:%v\n", string(body))

}
```



### 3.Get 请求添加请求头

```go
func testGetAddHeader() {
	client := &http.Client{}
	req, _ := http.NewRequest("GET", "http://httpbin.org/get", nil)
  //添加请求头信息
	req.Header.Add("name", "lisi")
	req.Header.Add("age", "80")
	resp, _ := client.Do(req) //发送请求
	body, _ := ioutil.ReadAll(resp.Body)
	defer resp.Body.Close()
	fmt.Printf(string(body))
} 
```



### 4.解析 Get请求返回的Json数据

```go
func testJson() {

	type Realtime struct {
		Temperature string `json:"temperature"`
		Humidity    string `json:"humidity"`
		Info        string `json:"info"`
		Wid         string `json:"wid"`
		Direct      string `json:"direct"`
		Power       string `json:"power"`
		Aqi         string `json:"aqi"`
	}

	type Wid struct {
		Day   string `json:"day"`
		Night string `json:"night"`
	}
	type Future struct {
		Date        string `json:"date"`
		Temperature string `json:"temperature"`
		Weather     string `json:"weather"`
		Wid         Wid    `json:"wid"`
		Direct      string `json:"direct"`
	}

	type Result struct {
		City     string   `json:"city"`
		Realtime Realtime `json:"realtime"`
		Future   []Future `json:"future"`
	}

	type AutoGenerated struct {
		Reason    string `json:"reason"`
		Result    Result `json:"result"`
		ErrorCode int    `json:"error_code"`
	}

	params := url.Values{}
	Url, err := url.Parse("http://apis.juhe.cn/simpleWeather/query")
	if err != nil {
		return
	}
	params.Set("city", "六安")
	params.Set("key", "e1ec69449d50d18e0b2a2ecf0")
	//	如果参数中有中文 那么这个方法要进行URLEncode
	Url.RawQuery = params.Encode()
	urlpath := Url.String()


	resp, err := http.Get(urlpath)
	if err != nil {
		log.Fatal(err)
	}

	defer resp.Body.Close()
	body, _ := ioutil.ReadAll(resp.Body)
	

	var auto AutoGenerated
	err = json.Unmarshal(body, &auto)
	if err != nil {
		log.Fatal("json parase failed")
	}
	fmt.Printf("%#v", auto)

}
```



### 5.使用Client 自定义请求

```go
func testClient() {
	url := "http://apis.juhe.cn/simpleWeather/query?city=上海&key=e1ec69449d50d18e0b2a2ec3"
	client := http.Client{
		Timeout: time.Second * 5,
	}
	request, err := http.NewRequest(http.MethodGet, url, nil)
	if err != nil {
		log.Fatal(err)
	}
	request.Header.Add("referer", "http://apis.juhe.cn/")
	resp, err := client.Do(request)
	defer resp.Body.Close()
	b, err := ioutil.ReadAll(resp.Body)
	fmt.Printf("%v\n", string(b))
}
```



### 6. 发送Post请求

方式一:

```go
func testpost() {
	urlstr := "http://apis.juhe.cn/simpleWeather/query"
	values := url.Values{}
	values.Set("key", "e1ec69449d50d18e0b2a2ec35ab36b")
	values.Set("city", "北京")
	r, err := http.PostForm(urlstr, values)
	if err != nil {
		log.Fatal(err)
	}

	defer r.Body.Close()
	b, _ := ioutil.ReadAll(r.Body)
	fmt.Printf("b:%v\n", string(b))
}
```



方式二:

```go
func testpost2() {
	urlvalues := url.Values{
		"key":  {"e1ec69449d50d18e0b2a2ec35ab36bf0"},
		"city": {"上海"},
	}

	reqBody := urlvalues.Encode()
	resp, err := http.Post("https://httpbin.org/post", "text/html", strings.NewReader(reqBody))
	if err != nil {
		log.Fatal(err)
	}

	body, err := ioutil.ReadAll(resp.Body)
	defer resp.Body.Close()
	fmt.Printf("%v", string(body))
}
```



### 7.Post 请求发送Json数据

```go
//post 发送Json数据
func testPostJson() {
	data := make(map[string]interface{})
	data["key"] = "8cc4a558d6e7dac64816f567e1ff0c69"
	data["city"] = "广州"
	byteData, _ := json.Marshal(data)
	resp, err := http.Post("https://httpbin.org/post", "application/json", bytes.NewReader(byteData))
	if err != nil {
		log.Fatal(err)
	}
	body, err := ioutil.ReadAll(resp.Body)
	fmt.Println(string(body))

}
```

